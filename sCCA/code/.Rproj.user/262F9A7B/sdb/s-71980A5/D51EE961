{
    "collab_server" : "",
    "contents" : "---\ntitle: \"R Notebook\"\noutput: html_notebook\n---\n```{r setup}\nknitr::opts_knit$set(root.dir = '/Users/hxia/Desktop/BBL/')\nrequire(\"rasterVis\")\nrequire('PMA')\nrequire('Matrix')\nrequire('parallel')\nrequire('emdbook')\nrequire('caret')\nrequire('R.matlab')\nrequire('MASS')\nrequire('permute')\nrequire('matrixStats')\nrequire('scales')\nrequire('ggrepel')\nrequire('cowplot')\nrequire('VIM')\nrequire('mice')\nrequire('abind')\nsource('~/Desktop/BBL/projects/xiaNetworkCca/sCCA/code/cca_functions.R')\n```\n\n```{r}\nSTAI <-read.csv(\"~/Desktop/BBL/studies/pnc/n1601_dataFreezeDec2016/clinical/n1601_stai_pre_post_itemwise_smry_factors_20170131.csv\",stringsAsFactors=FALSE)\nSTAI <-apply(STAI,2,as.numeric)\npre1 <- STAI[,5:(5+20-1)]\npre1_sum<-rowSums(pre1)\npre2 <- STAI[,(5+20):(5+40-1)]\npre2_sum<-rowSums(pre2,na.rm=T)\nplot(pre1_sum,STAI[,3])\nplot(pre2_sum,STAI[,4])\n\ntrait <-pre2\ntrait_sum <- pre2_sum\ntrait_miss <- aggr(trait)\ntrait_inc <- trait[-which(pre2_sum ==0),]\ntrait_inc_miss <- aggr(trait_inc)\n \n\nnumImp <- 15\ntrait.inc.imp <- mice(trait_inc, m = numImp, maxit = 20, method= \"pmm\",visitSequence = 'monotone',printFlag = FALSE)\n\ntrait.cpl.rm<-lapply(1:numImp,function(x) complete(trait.inc.imp,action = x))\ntrait.cpl.rm.out<-do.call(abind, c(trait.cpl.rm, along = 3))\ntrait.cpl.rm.out.mean<-apply(trait.cpl.rm.out, c(1,2), mean)\ntrait.cpl.rm.out.round <- round(trait.cpl.rm.out.mean)\n\ntrait.final <- cbind(bblid = STAI[-which(pre2_sum ==0),1],trait.cpl.rm.out.round)\ntrait.final <- as.data.frame(trait.final)\n\nsave(trait_miss,trait.final,trait.inc.imp, trait_inc,file = './projects/xiaNetworkCca/sCCA/aim1/result/201701/trait_impute.RData')\n```\n\n```{r}\nload(\"./projects/xiaNetworkCca/sCCA/aim1/result/201701/pwr_train_qa.RData\")\ntrait.final.train <-subset(trait.final,bblid %in% pwr_train_qa$bblid)\ntrait.bblid.inc <- pwr_train_qa$bblid %in% trait.final.train$bblid\nsample_qa <- subset(pwr_train_qa, bblid %in% trait.final.train$bblid)\n\n\n\nload(\"~/Desktop/BBL/projects/xiaNetworkCca/sCCA/aim1/result/201701/med_cv_split.RData\")\nmed.trait <- subset(med.train, bblid %in% pwr_train_qa$bblid)\nmed.trait <- med.trait[\\gg,]\n\nmed.n.trait <- cbind(med.trait,within(trait.final.train,rm(\"bblid\")))\n\n#only get the ones older than 11 years old\nmed.n.trait <- subset(med.n.trait, sample_qa$ageAtScan1 >= 11*12)\n\nsample_qa <- subset(sample_qa, ageAtScan1 >= 11*12)\n\nsample_qa$sex <- as.factor(sample_qa$sex)\nsample_qa$race2 <- as.factor(sample_qa$race2)\n\nmed.n.trait.torgr <- within(med.n.trait, rm(\"bblid\"))\nrownames(med.n.trait.torgr) <- med.n.trait$bblid\n\nmed.n.trait.rgr.con <- apply(med.n.trait.torgr[,c(1:12,112:131)], 2, function(x) residuals.glm(glm(x ~ ageAtScan1 + \n    sex + race2, data = sample_qa ), type = \"response\"))\n#regress out the binary variables (everything else)\nmed.n.trait.rgr.binary <- apply(med.n.trait.torgr[,13:111], 2, function(x) residuals.glm(glm(x ~ ageAtScan1 + \n    sex + race2, family= binomial(link=\"logit\"),data = sample_qa ), type = \"response\"))\n\n\nmed.n.trait.rgr <- cbind(med.n.trait.rgr.con[,1:12],med.n.trait.rgr.binary,med.n.trait.rgr.con[,13:32])\nrownames(med.n.trait.rgr) <- sample_qa$bblid\n\nsave(med.n.trait.rgr,file = \"./projects/xiaNetworkCca/sCCA/aim1/result/201701/pwr_med_n_trait_rgr.RData\")\nsave(sample_qa, file = \"./projects/xiaNetworkCca/sCCA/aim1/result/201701/pwr_trait_qa.RData\")\n```\n\n```{r}\nload(\"~/Desktop/BBL/projects/xiaNetworkCca/sCCA/aim1/result/201701/pwr_train_net_ft.RData\")\nload('./projects/xiaNetworkCca/sCCA/aim1/result/201701/pwr_3k_stats.RData')\npwr_train_net_ft <- subset(pwr_train_net_ft, rownames(pwr_train_net_ft) %in% sample_qa$bblid)\npwr_trait_net_ft <- pwr_train_net_ft[,pwr.3k.train.idx]\n\npower.trait.rgr <- apply(pwr_trait_net_ft, 2, function(x) residuals.glm(glm(x ~ ageAtScan1 + \n    sex + race2 + restRelMeanRMSMotion, data = sample_qa), type = \"response\"))\nrownames(power.trait.rgr) <- sample_qa$bblid\nsave(power.trait.rgr,file = \"./projects/xiaNetworkCca/sCCA/aim1/result/201701/pwr_net_n_trait_rgr.RData\")\n```\n",
    "created" : 1486588502158.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3134161214",
    "id" : "D51EE961",
    "lastKnownWriteTime" : 1486702594,
    "last_content_update" : 1486702597850,
    "path" : "~/Desktop/BBL/projects/xiaNetworkCca/sCCA/code/trait_impute.Rmd",
    "project_path" : "trait_impute.Rmd",
    "properties" : {
        "chunk_output_type" : "inline",
        "last_setup_crc32" : "A65079FE5526a2d1",
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}